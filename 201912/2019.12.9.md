2019.12.9

[TOC]

#### 1.Elasticsearch 优化

0.对于有中文搜索需求的，要安装中文分词插件

1.建索引时要对需要的字段进行mapping 映射，指定中文分词，选项有两个

```
ik_max_word
ik_smart
```

2.生成关键词时要建立本地关键词库，第一次生成时可以导入外部关键词库，这样可以较高效率的提取中有用的关键词。

3.对于ElasticSearch 只查询部分字段时，可以直接在查询语句中指定，例子如下：

```
{
  "query": {"multi_match": {
      "query": "要搜索的字段",
      "type": "most_fields",
      "fields": "content",
      "minimum_should_match":"65%"}},
  "from": 0,
  "size":20,
  "highlight": {"fields": {
        "content": {}}}
  , "_source": ["title","highlight"]
}
```

- 其中size 为每页字段数

- form 为第几页

- field为查询的字段

- 通过source字段指定返回部分字段，而不返回全部字段

4.查询策略

首先进行精确查询，将精确查询结果放在最前。

如果精确查询值较少或者不存在，再进行分词查询。

如果前两项查询不满足设定的阈值，再进行模糊查询。



