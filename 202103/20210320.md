### MySQL查询性能优化



#### 1.查询慢的原因

##### 1.1查询的生命周期

​	查询的生命周期大致可以按照顺序来看

**从客户端  --> 到服务器 --> 然后再服务器上进行解析 --> 生成执行计划 --> 执行 ---> 返回结果给客户端**

​	其中**执行** 是整个生命周期中最重要的阶段，因为这执行这个阶段 有着**大量为了检索数据到存储引擎的调用以及调用后的数据处理，包括排序、分组等。**

​	查询会在不同的地方产生时间消耗，包括**网络**，**CPU计算**，**生成统计信息和执行计划**，**锁等待(互斥等待)** 等操作，特别是**向底层存储引擎检索数据的调用操作**，这些操作需要在**内存操作**、**CPU操作**和**内存不足时导致等待I/O操作**上消耗时间。如果存储引擎不同，可能会产生**大量的上下文切换以及系统调用。**

#### 2.慢查询基础：优化数据访问

​	低效查询的两种情况:

**2.1.确认应用程序是否在检索大量超过需要的数据。**

【1】查询了不需要的记录

【2】多表关联时返回全部列

【3】总是取出全部列

【4】重复查询相同的数据

**2.2.确认MySQL 服务器层是否在分析大量超过需要的数据行**

【1】响应时间

【2】扫描的行数

【3】返回的行数



#### 3.重构查询方式

【1】一个复杂查询还是多个简单查询

【2】切分查询,将大查询切分成小查询

【3】分解关联查询



#### 4.查询执行的基础

 当向MySQL 发送一个请求的时候，MySQL 到底做了些什么:

**【1】.客户端发送一条查询给服务器**

**【2】.服务器先检查查询缓存，如果命中率缓存则立刻返回存储在缓存中的结果，否则进入下一阶段**

**【3】.服务端进行SQL解析、预处理，再由优化器生成对应的执行计划**

**【4】.MySQL 根据优化器生成的执行计划，调用存储引擎的API来执行查询**

**【5】.将上面的结果返回**





#### 5.查询优化器的局限性

#### 6.查询优化器的提示(hint)

#### 7.优化特定查询类型